requirejs.config({

	paths : {
		'vlib' : 'core/Vlib',
		'config' : 'config.vlib',
		'pluginLoader' : 'pluginLoader',
		'jquery_ui' : 'libs/jquery-ui/js/jquery-ui-1.10.3.custom.min',
		'jquery' : 'libs/jquery/jquery.min',
		'underscore' : 'libs/underscore/underscore.min',
		'three' : 'libs/three/build/three.min',
		'three_tween' : 'libs/three/build/tween',
		'three_buffer' : 'libs/three/build/BufferGeometryUtils',
		'three_trackball_controls' : 'libs/three/controls/TrackballControls',
		'three_orbit_controls' : 'libs/three/controls/OrbitAndPanControls',
		'three_svg_renderer' : 'libs/three/src/renderers/SVGRenderer',
		'orgChart' : 'libs/jOrgChart/jquery.jOrgChart',
		'bootstrap':'libs/bootstrap/bootstrap.min',
		'd3':'libs/novus/lib/d3.v3',
		'nv':'libs/novus/nv.d3'

	},
	shim : {

		'underscore' : {
			exports : '_'
		},

		'three' : {
			exports : 'THREE'
		},
		'three_tween' : {
			exports : 'TWEEN'
		},
		'three_svg_renderer' : {
			'deps' : ['three'],
			exports : 'THREE'
		},
		'three_buffer' : {
			'deps' : ['three'],
			exports : 'THREE'
		},
		'three_trackball_controls' : {
			exports : 'THREE',
			'deps' : ['three']
		},
		'three_orbit_controls' : {
			exports : 'THREE',
			'deps' : ['three']
		},
		'jquery_ui' : {
			exports : '$',
			'deps' : ['jquery']
		},
		'orgChart' : {
			exports : '$',
			'deps' : ['jquery']
		},
		'bootstrap' : {
			'deps' : ['jquery']
		},
		'd3':{
			exports: 'd3'
		},
		'nv':{
			'deps' : ['d3'],
			exports: 'd3'
		}

	}
})
/**
	Handles wordpress frontend. <br />
	This module is a main entrypoint, which can be included into a webside.<br />
	It will replace wordpress shorttags (<b>[vlib id=TEMPLATE_ID] </b>) by VLib plot modules. <br />
	<b>TEMPLATE_ID</b>s will be loaded from the server and forwarded to the coresponding plot instance.
	@module main
	@uses jQuery, Config
	@example
		<script data-main="js/libs/VLib/main" src="js/libs/VLib/require.min.js"></script>


**/

 define(function(require) {

 	require(
 		[ 'jquery', 'config'],
 		function($,Config) {
 		var absPathToRequestHandler = window.vlib_globals.wpurl+'/';

	 	// ************************************************************************
		// INIT LIB
		// ************************************************************************
		var VLib = require('vlib');
		var v = new VLib();

		var plotModule = require('core/modules/plot/plot.vlib');

		var run = function(){

			$('.vlib-plot').each(function(e){

				var templ_id = $(this).attr('id');
				var plot = new plotModule();
				v.registerModule(plot);


				var jsonObj = {"action": "get_t_id", "id": templ_id};
				var postData = JSON.stringify(jsonObj);
				var postArray = {json:postData};

				plot.init("#"+templ_id);
				$.ajax({
					type: 'POST',
					url: absPathToRequestHandler+"process.php",
					data: postArray,
					success: function(data){
						var d = $.parseJSON(data);
						for (var i=0; i < d.length; i++) {

							var templateTmp = {
								sceneGraph	: JSON.parse(d[i].template_graph),
								name		: d[i].id + "-" +d[i].template_name,
								description	: d[i].template_description
							};
							console.log(JSON.stringify(templateTmp));
							v.load(templateTmp,plot);
						}
							// ADD AJAX CALL HERE...
							// if OK register template
							//v.registerTemplate(_.clone(template));
						},
					error : function(e){
						alert(JSON.stringify(e));
					}
					});

				//AJAX-load template
				//var template = load(templ_id);

			});
		}
		$(document).ready(function(){
			run();
		});

	});






});
