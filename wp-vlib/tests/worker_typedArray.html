<html>
<head>
	<title>Worker - typed arrays</title>
	<link rel="stylesheet" href="../css/bootstrap/dist/css/bootstrap.min.css">
	<style>
		H1, H2, H3, H4 {
			margin: 0px;
			text-align: center;
			width: 100%;
		}
		.seperator {
			margin-bottom: 50px;
		}

	</style>
</head>
<body>
	<h1>WorkerFactory.vlib</h1>
	<h3>Takes a WorkerFactory.TASK and returns a WorkerFactory.WorkerWrapper object</h3>
	<h4>WorkerWrapper holds either an instance of a WebWorker or a PseudoWorker</h4>
	<div class="seperator"></div>
	<div class="logContainer">
		<div class="list-group" >
			<a href="#" class="list-group-item active">
			<div id="log_title">Send:<br /> </div>
			</a>
			<div id="log"></div>
		</div>
	</div>
	<script src="../js/VLib/require.min.js"></script>
	<script>
		requirejs.config({
			appDir: "../",
			baseUrl: "../js/VLib",
			paths : {
				'jquery' : 'libs/jquery/jquery.min',
				'config' : 'config.vlib',
			}

		});
		require(['core/WorkerFactory_2.vlib','jquery'],function(WorkerFactory,$){
			var sc = $('#log_title');
			var rc = $('#log');
			var wf = new WorkerFactory();
			var worker = wf.create(wf.TASK.TASK_SCALE_FLOAT32ARRAY_LIN);
			worker.onmessage = function(e){
				if(e.data.status === "ok"){
					console.log(e.data);
					var data = e.data.response.data;
					var dataArray = new Float32Array(data);
					var result = "";
					for( var i = 0, len = dataArray.length; i < len; ++i){
						result += dataArray[ i ].toFixed(0)+" ";
					}
					rc.append('<div class="list-group-item">[ Receive STATUS.OK ] '+result+'</div>');
				}else if(e.data.status === "done"){
					rc.append('<div class="list-group-item">[ Receive STATUS.DONE ]</div>');
				}else if(e.data.status === "info"){
					rc.append('<div class="list-group-item">[ Receive STATUS.INFO ] ' +e.data.response+'</div>');
				}else if( e.data.status === "error" ){
					console.warn(e.data.response);
				}

			};
			var size = 10;
			var borders = {
				"x_MAX":size,
				"y_MAX":size,
				"z_MAX":size,
				"x_MIN":0,
				"y_MIN":0,
				"z_MIN":0,
				"x_SCALE_MIN" : 0,
				"y_SCALE_MIN" : 0,
				"z_SCALE_MIN" : 0,
				"x_SCALE_MAX" : 100,
				"y_SCALE_MAX" : 200,
				"z_SCALE_MAX" : 300
			};
			var data = new Float32Array(size * 3);
			for(var i = 1, j = 0, len = data.length; i < len; ++i, j+= 3){
				data[ j ] = i;
				data[ j+1 ] = i;
				data[ j+2 ] = i;
			}
			var msg = {
				packageSize : 3,
				borders : borders,
				offset : 0,
				data : data
			};
			/* show data send */
			sc.append("Scale x * 10, y * 20, z*30 ");
			sc.append("PackageSize = "+ msg.packageSize+"<br />Data = ");
			for( var i = 0, len = data.length; i < len; ++i){
				sc.append(data[ i ]+" ");
			}

			worker.postMessage( msg, [ msg.data.buffer ] );
		});



</script>

</body>
</html>
